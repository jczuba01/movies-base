<div class="container mt-4">
  <h1>Movies</h1>

  <%= link_to "New Movie", new_movie_path, class: "btn btn-primary mb-3" %>

<div class="card mb-3">
  <div class="card-body">
    <%= search_form_for @q do |f| %>
      <div class="row align-items-end">
        <div class="col-md-2">
          <%= f.label :title_cont, "Title contains", class: "form-label" %>
          <%= f.search_field :title_cont, class: "form-control form-control-sm" %>
        </div>
        <div class="col-md-2">
          <%= f.label :genre_id_eq, "Genre", class: "form-label" %>
          <%= f.collection_select :genre_id_eq, Genre.all, :id, :name, { include_blank: "Any genre" }, { class: "form-select form-select-sm" } %>
        </div>
        <div class="col-md-2">
          <%= f.label :duration_minutes_lteq, "Max duration", class: "form-label" %>
          <%= f.number_field :duration_minutes_lteq, class: "form-control form-control-sm", min: 0 %>
        </div>
        <div class="col-md-2">
          <%= f.label :director_id_eq, "Director", class: "form-label" %>
          <%= f.collection_select :director_id_eq, Director.all, :id, :last_name, { include_blank: "Any director" }, { class: "form-select form-select-sm" } %>
        </div>
        <div class="col-md-2">
          <%= f.label :origin_country_eq, "Origin country", class: "form-label" %>
          <%= f.select :origin_country_eq, Movie.distinct.pluck(:origin_country).compact.sort, { include_blank: "Any country" }, { class: "form-select form-select-sm" } %>
        </div>
        <div class="col-md-2">
          <%= f.submit "Search", class: "btn btn-primary btn-sm me-1" %>
          <%= link_to "Reset", movies_path, class: "btn btn-secondary btn-sm" %>
        </div>
      </div>
    <% end %>
  </div>
</div>
  
  <table class="table table-striped table-bordered">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th><%= sort_link(@q, :title, "Title") %></th>
        <th><%= sort_link(@q, :genre_name, "Genre") %></th>
        <th><%= sort_link(@q, :duration_minutes, "Duration in Minutes") %></th>
        <th><%= sort_link(@q, :director_last_name, "Director") %></th>
        <th><%= sort_link(@q, :origin_country, "Origin Country") %></th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @movies.each do |movie| %>
        <tr>
          <td><%= movie.id %></td>
          <td><%= link_to movie.title, movie %></td>
          <td><%= link_to movie.genre.name, movie.genre %></td>
          <td><%= movie.duration_minutes %></td>
          <td><%= link_to "#{movie.director.first_name} #{movie.director.last_name}", movie.director %></td> <!-- Assuming Director relation -->
          <td><%= movie.origin_country %></td>
          <td>
            <%= link_to "Edit", edit_movie_path(movie), class: "btn btn-warning btn-sm" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
</div>